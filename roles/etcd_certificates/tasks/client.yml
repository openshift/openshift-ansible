---
- name: Check status of external etcd certificatees
  stat:
    path: "{{ etcd_cert_config_dir }}/{{ item }}"
  with_items:
  - "{{ etcd_cert_prefix }}client.crt"
  - "{{ etcd_cert_prefix }}client.key"
  - "{{ etcd_cert_prefix }}ca.crt"
  register: g_external_etcd_cert_stat_result
  when: etcd_certificates_etcd_hosts | default([]) | length > 0

- set_fact:
    etcd_client_certs_missing: "{{ False in (g_external_etcd_cert_stat_result.results
                                   | oo_collect(attribute='stat.exists')
                                   | list) }}"
  when: etcd_certificates_etcd_hosts | default([]) | length > 0

- include: create_client_certificates.yml
  when: etcd_certificates_etcd_hosts | default([]) | length > 0 and etcd_client_certs_missing | bool
