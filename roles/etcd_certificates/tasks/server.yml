---
- name: Check status of etcd certificates
  stat:
    path: "{{ etcd_cert_config_dir }}/{{ item }}"
  with_items:
  - "{{ etcd_cert_prefix }}server.crt"
  - "{{ etcd_cert_prefix }}peer.crt"
  - "{{ etcd_cert_prefix }}ca.crt"
  register: g_etcd_server_cert_stat_result

- set_fact:
    etcd_server_certs_missing: "{{ False in (g_etcd_server_cert_stat_result.results
                                   | oo_collect(attribute='stat.exists')
                                   | list) }}"

- include: create_server_certificates.yml
  when: etcd_server_certs_missing | bool
