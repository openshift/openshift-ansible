---
- name: Set nodelabel OpenShift facts
  set_fact:
      infranode_label: "{{ ocom_infra_node_label | default(openshift.common.infranode_label) }}"

- name: Deploy registry
  shell: "osadm registry --create --credentials=/var/lib/openshift/openshift.local.certificates/openshift-registry/.kubeconfig --images='registry.access.redhat.com/openshift3_beta/ose-${component}:${version}'"


- name: Set region for registry
  shell: "osc update deploymentConfig docker-registry --patch='{\"apiVersion\":\"v1beta1\",\"template\":{\"controllerTemplate\":{\"podTemplate\":{\"nodeSelector\":{\"region\":\"{{infranode_label}}\"}}}}}'"
