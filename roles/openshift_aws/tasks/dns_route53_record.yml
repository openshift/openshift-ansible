---
- debug: msg="{{ l_dnsrecords_dict_item }}"

- name: querying elb
  ec2_elb_facts:
    names: "{{ l_dnsrecords_dict_item.value }}"
    region: "{{ openshift_aws_region }}"
  register: elb_facts
  when:
    - "'elb' in l_dnsrecords_dict_item.kind"
    - "'CNAME' in l_dnsrecords_dict_item.type"

- name: creating record
  route53:
    command: create
    overwrite: no
    private_zone: "{{ (l_dns_dict_item.key == 'internal') | ternary('yes','no') }}"
    record: "{{ l_dnsrecords_dict_item.name }}.{{ l_dns_dict_item.value['zone'] }}"
    type: "{{ l_dnsrecords_dict_item.type }}"
    ttl: 300
    value: "{{ value | trim }}"
    zone: "{{ l_dns_dict_item.value['zone'] }}"
  vars:
    value: "{% if 'CNAME' in l_dnsrecords_dict_item.type -%} {{ elb_facts.elbs[0].dns_name }} \
            {% endif -%}"
