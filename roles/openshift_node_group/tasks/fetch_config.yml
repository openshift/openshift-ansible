---
# This file is looped over, must use include_tasks, not import_tasks
- name: verify API server
  # Using curl here since the uri module requires python-httplib2 and
  # wait_for port doesn't provide health information.
  command: >
    curl --silent --tlsv1.2 --max-time 2
    --cacert {{ openshift.common.config_base }}/master/ca-bundle.crt
    {{ openshift.master.api_url }}/healthz/ready
  args:
    # Disables the following warning:
    # Consider using get_url or uri module rather than running curl
    warn: no
  register: l_api_available_output
  until: l_api_available_output.stdout == 'ok'
  retries: 120
  delay: 1
  changed_when: false

- name: fetch node configmap
  oc_configmap:
    name: "{{ l_openshift_node_group_name }}"
    namespace: "{{ openshift_node_group_namespace }}"
    state: list
  register: configout
  run_once: true

- name: debug node config
  debug:
    var: configout
  run_once: true
