---
- name: Fail if r_openshift_node_facts_debug_level is not defined
  fail:
    msg: r_openshift_node_facts_debug_level must be specified for this role
  when:
  - r_openshift_node_facts_debug_level is not defined

- set_fact:
    openshift_node_debug_level: "{{ lookup('oo_option', 'openshift_node_debug_level') }}"
  when:
  - r_openshift_node_facts_debug_level is not defined
  - lookup('oo_option', 'openshift_node_debug_level') != ""

- name: Set node facts
  openshift_facts:
    role: "{{ item.role }}"
    local_facts: "{{ item.local_facts }}"
  with_items:
  # Reset node labels to an empty dictionary.
  - role: node
    local_facts:
      labels: {}
  - role: node
    local_facts:
      annotations: "{{ r_openshift_node_facts_annotations }}"
      debug_level: "{{ r_openshift_node_facts_debug_level }}"
      iptables_sync_period: "{{ r_openshift_node_facts_iptables_sync_period }}"
      kubelet_args: "{{ r_openshift_node_facts_kubelet_args }}"
      labels: "{{ r_openshift_node_facts_labels }}"
      registry_url: "{{ r_openshift_node_facts_oreg_url }}"
      schedulable: "{{ r_openshift_node_facts_schedulable }}"
      sdn_mtu: "{{ r_openshift_node_facts_sdn_mtu }}"
      storage_plugin_deps: "{{ r_openshift_node_facts_osn_storage_plugin_deps }}"
      set_node_ip: "{{ r_openshift_node_facts_set_node_ip }}"
      node_image: "{{ r_openshift_node_facts_osn_image }}"
      ovs_image: "{{ r_openshift_node_facts_osn_ovs_image }}"
      proxy_mode: "{{ r_openshift_node_facts_proxy_mode }}"
      local_quota_per_fsgroup: "{{ r_openshift_node_facts_local_quota_per_fsgroup }}"
      # get_dns_ip is defined in filter_plugins/openshift_ndde.py
      dns_ip: "{{ r_openshift_node_facts_dns_ip | get_dns_ip(hostvars[inventory_hostname])}}"
      env_vars: "{{ r_openshift_node_facts_env_vars }}"
