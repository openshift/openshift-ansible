---
- name: Stop node
  service:
    name: "{{ item }}"
    state: stopped
  with_items:
  - "{{ openshift_service_type }}-node"
  failed_when: false

- name: Stop openvswitch services
  service:
    name: "openvswitch"
    state: stopped
  when: not openshift_use_openshift_sdn | bool
  failed_when: false

- name: Ensure static containerized services stopped before Docker restart
  command: /usr/local/bin/master-restart "{{ item }}"
  with_items:
  - api
  - controllers
  - etcd
  failed_when: false

- service:
    name: docker
    state: stopped
  register: l_openshift_node_upgrade_docker_stop_result
  until: not (l_openshift_node_upgrade_docker_stop_result is failed)
  retries: 3
  delay: 30
  when:
  - l_docker_upgrade is defined
  - l_docker_upgrade | bool

- name: Stop rpm based services
  service:
    name: "{{ item }}"
    state: stopped
  with_items:
  - "{{ openshift_service_type }}-node"
  failed_when: false
  when: not openshift_is_containerized | bool

- name: Stop ovs rpm based services
  service:
    name: "openvswitch"
    state: stopped
  failed_when: false
  when: 
  - not openshift_is_containerized | bool
  - not openshift_use_openshift_sdn | bool
