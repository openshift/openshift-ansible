---
- name: Install openshift packages
  package:
    name: "{{ openshift_node_install_packages | join(',') }}"
    update_cache: true
  register: install_openshift
  until: install_openshift.rc == 0
  retries: 3
  delay: 1

- name: Enable the CRI-O service
  systemd:
    name: "cri-o"
    enabled: yes

- name: Install openshift packages
  package:
    name: "{{ l_node_packages | join(',') }}"
  register: install_openshift
  until: install_openshift.rc == 0
  retries: 3
  delay: 1
  vars:
    l_node_packages:
    - "{{ openshift_service_type }}-node{{ (openshift_pkg_version | default('')) | lib_utils_oo_image_tag_to_rpm_version(include_dash=True) }}"
    - "{{ openshift_service_type }}-clients{{ (openshift_pkg_version | default('')) | lib_utils_oo_image_tag_to_rpm_version(include_dash=True) }}"
    - "{{ openshift_service_type }}-hyperkube{{ (openshift_pkg_version | default('')) | lib_utils_oo_image_tag_to_rpm_version(include_dash=True) }}"
