---
# Work around ini_file create option in 2.2 which defaults to no
- name: Create cloud config file
  file:
    dest: "{{ openshift.common.config_base }}/cloudprovider/aws.conf"
    state: touch
    mode: 0660
    owner: root
    group: root
  changed_when: false

- name: Configure AWS cloud provider
  ini_file:
    dest: "{{ openshift.common.config_base }}/cloudprovider/aws.conf"
    section: Global
    option: Zone
    value: "{{ openshift.provider.zone }}"

# 3.6 and newer use KubernetesClusterID
- name: Configure AWS KubernetesClusterID
  ini_file:
    dest: "{{ openshift.common.config_base }}/cloudprovider/aws.conf"
    section: Global
    option: KubernetesClusterID
    value: "{{ openshift_cloudprovider_aws_cluster_id }}"

# 3.5 and older use KubernetesClusterTag
- name: Configure AWS KubernetesClusterTag
  ini_file:
    dest: "{{ openshift.common.config_base }}/cloudprovider/aws.conf"
    section: Global
    option: KubernetesClusterTag
    value: "{{ openshift_cloudprovider_aws_cluster_id }}"
