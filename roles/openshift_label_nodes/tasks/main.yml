---
- name: Get Nodes Config
  shell: osc get nodes -o json | sed -e '/"resourceVersion"/d'
  register: output

- name: Set node regions
    node_facts: "{{ output.stdout | from_json
                  | oo_set_node_label('region', {{oln_node_region}}) }}"

- name: Set infra node labels
  set_fact:
    node_final_facts: "{{ node_facts
                  | oo_set_node_label('region', {{ocom_infra_node_label}}, {{oln_infra_node_filter_key}}, {{oln_infra_node_filter_value}}) }}"

- name: Write node config to temp file
  copy:
    content: "{{ node_final_facts }}"
    dest: /tmp/nodes.json

- name: Import new node config
  shell: osc update node -f /tmp/nodes.json

- name: Remove node temp file
  file:
    path: /tmp/nodes.json
	  state: absent
