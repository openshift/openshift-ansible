#
# TODO: use a formal set of role parameters consistent with openshift_aws
#
---
- when: state | default('present') == 'present'
  block:
  - name: Provision GCP DNS domain
    import_tasks: dns-zone.yml

  - name: Create GCP ssh key
    import_tasks: gcp-ssh-key.yml

  - name: Create Master LB HTTPS certificate
    import_tasks: ssl-certificate.yml

  - name: Create empty 1g image
    import_tasks: empty-image.yml

  - name: Provision network in GCP
    import_tasks: deployment-create.yml
    vars:
      openshift_gcp_deployment_name: network

  - name: Provision core infrastructure in GCP
    import_tasks: deployment-create.yml
    vars:
      openshift_gcp_deployment_name: core

  - name: wait for instance groups to be ready
    import_tasks: wait-for-instance-groups.yml

  - meta: refresh_inventory

  - name: configure dns records
    import_tasks: dns-records.yml

- when: state | default('present') == 'absent'
  block:
  - name: Deprovision core infrastructure in GCP
    import_tasks: deployment-delete.yml
    vars:
      openshift_gcp_deployment_name: core

  - name: Deprovision network in GCP
    import_tasks: deployment-delete.yml
    vars:
      openshift_gcp_deployment_name: network

  - name: Delete empty 1g image
    import_tasks: empty-image-delete.yml

  - name: Delete Master LB HTTPS certificate
    import_tasks: ssl-certificate-delete.yml
