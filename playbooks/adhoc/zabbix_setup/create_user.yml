---
# export PYTHONPATH='/usr/lib/python2.7/site-packages/:/home/kwoodson/git/openshift-tools'
# ansible-playbook -e 'cli_password=zabbix' -e 'cli_new_password=new-zabbix' create_user.yml
- hosts: localhost
  gather_facts: no
  vars_files:
  - vars/template_heartbeat.yml
  - vars/template_os_linux.yml
  vars:
    g_zserver: http://localhost/zabbix/api_jsonrpc.php
    g_zuser: admin
    g_zpassword: "{{ cli_password }}"
  roles:
  - ../../../roles/os_zabbix
  post_tasks:
  - zbx_user:
      server: "{{ g_zserver }}"
      user: "{{ g_zuser }}"
      password: "{{ g_zpassword }}"
      state: list
    register: users

  - debug: var=users

  - name: Update zabbix creds for admin
    zbx_user:
      server: "{{ g_zserver }}"
      user: "{{ g_zuser }}"
      password: "{{ g_zpassword }}"
      alias: Admin
      passwd: "{{ cli_new_password | default(g_zpassword, true) }}"
