---
- name: Populate oo_hosts_to_config host group if needed
  hosts: localhost
  gather_facts: no
  tasks:
  - name: Evaluate oo_host_group_exp if it's set
    add_host: "name={{ item }} groups=oo_hosts_to_config"
    with_items: "{{ oo_host_group_exp | default('') }}"
    when: oo_host_group_exp is defined

- name: "Gather facts for nodes in {{ oo_env }}"
  hosts: "tag_env-host-type_{{ oo_env }}-openshift-node"

- name: Configure instances
  hosts: oo_hosts_to_config
  vars_files:
  - vars.yml
  vars:
    openshift_node_ips: "{{ hostvars
        | oo_select_keys(groups['tag_env-host-type_' + oo_env + '-openshift-node'])
        | oo_collect(attribute='ansible_default_ipv4.address') | default(['']) }}"
  roles:
    - base_os
    - repos
    - openshift-master
    - pods
