---
- name: Populate oo_hosts_to_update group
  hosts: localhost
  gather_facts: no
  vars_files:
  - vars.yml
  tasks:
  - name: Evaluate oo_hosts_to_update
    add_host:
      name: "{{ item }}"
      groups: oo_hosts_to_update
      ansible_ssh_user: "{{ deployment_vars[deployment_type].ssh_user }}"
      ansible_sudo: "{{ deployment_vars[deployment_type].sudo }}"
    with_items: groups["tag_env-host-type_{{ cluster_id }}-openshift-master"] | union(groups["tag_env-host-type_{{ cluster_id }}-openshift-node"]) | default([])

- include: ../../common/openshift-cluster/update_repos_and_packages.yml

- name: Utilize entire disk
  hosts: oo_hosts_to_update
  gather_facts: no
  roles:
  - role: openshift_expand_partition
    oep_drive: "/dev/xvda"
    oep_partition: 3
    oep_file_system: "xfs"

- include: config.yml

- name: Use direct-lvm for docker cache storage
  hosts: oo_nodes_deployment_type_online
  gather_facts: no
  roles:
  - role: docker_storage
    dst_device: /dev/xvdb
    dst_vg: direct-lvm
    dst_options:
    - key: dm.datadev
      value: /dev/direct-lvm/data
    - key: dm.metadatadev
      value: /dev/direct-lvm/metadata
    - key: dm.fs
      value: xfs
